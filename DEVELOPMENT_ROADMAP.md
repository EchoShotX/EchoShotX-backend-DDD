# EchoShotX 개발 로드맵 및 마일스톤

## 📋 프로젝트 개요

EchoShotX는 공연장에서 촬영한 영상을 AI 기반으로 후처리하여 고품질 직캠 영상을 생성하는 모바일 기반 서비스입니다.

### 핵심 기능
- **A영상**: 전체 무대 영상 (1배율) - 무료 제공
- **B영상**: 사용자 시선 추적 확대 영상 - 무료 제공  
- **C영상**: AI 후처리를 통한 고품질 직캠 - **토큰 결제 기반**
- **하이라이트 클립**: 음악 분석 기반 자동 클립 생성 - **프리미엄 기능**
- **토큰 시스템**: 결제를 통한 크레딧 구매, 고급 AI 모델 이용

### 🏗️ 전체 시스템 아키텍처

**Spring 서버는 모바일 앱과 파이썬 AI 서버를 연결하는 핵심 오케스트레이션 역할을 담당합니다.**

**아키텍처 결정 이유:**
1. **확장성**: 대용량 비디오 파일(GB급) 안정적 처리
2. **성능**: CDN 연동으로 글로벌 고속 다운로드  
3. **안정성**: S3 99.999999999% 내구성 보장
4. **동시성**: 수백명 동시 다운로드 지원
5. **비용 효율성**: 스토리지 계층화 및 생명주기 관리
6. **통합 AI 서비스**: 영상처리, 얼굴인식, 음악분석을 포함한 단일 파이썬 AI 서버 연동

---

## 🎯 전체 개발 일정

**총 개발 기간**: 14-16주 (3.5-4개월)  
**팀 구성**: Spring Backend 개발자 1명 기준
**핵심 기능**: 파이썬 AI 서버 연동, 얼굴 인식, 음악 분석, 하이라이트 클립 생성

---

## 🏗️ Phase 1: 도메인 모델 설계 및 기본 API (3주)

### Week 1: 도메인 모델 확장 및 토큰 시스템

#### 📅 Day 1-2: Video 도메인 완전 재설계

**구체적 작업:**
- [ ] VideoType enum 생성 (A_VIDEO, B_VIDEO, C_VIDEO)
- [ ] ProcessingProgress VO 구현 (진행률, 예상완료시간, 단계별 상태)
- [ ] HighlightClip 엔티티 생성 (클립 타입: INTRO, CHORUS, BRIDGE, CLIMAX)
- [ ] FaceRecognitionResult 엔티티 생성 (프레임별 얼굴 좌표 저장)
- [ ] MusicAnalysisResult 엔티티 생성 (음악 구조 분석 결과)
- [ ] CaptureMetadata VO 생성 (줌 배율, 중심 좌표 로그)
- [ ] Video-HighlightClip 연관관계 매핑
- [ ] JPA Repository 인터페이스 정의

#### 📅 Day 3-4: 토큰 시스템 핵심 구현

**구체적 작업:**
- [ ] Member 엔티티에 currentTokens 필드 추가
- [ ] TokenPurchase, TokenUsage 엔티티 생성
- [ ] 토큰 차감/환불 비즈니스 로직 구현
- [ ] 처리 타입별 토큰 비용 정책 구현 (Strategy Pattern)

#### 📅 Day 5: 기본 Repository 및 Service 레이어
**구체적 작업:**
- [ ] VideoRepository 확장 (타입별, 상태별 조회 메서드)
- [ ] TokenService 구현 (구매, 사용, 잔여량 조회)
- [ ] VideoService 기본 CRUD 구현
- [ ] 단위 테스트 작성 (Coverage 80% 이상)

#### 🎯 완료 기준
- 모든 엔티티 JPA 매핑 완료
- 토큰 구매/사용 시나리오 테스트 통과
- Repository 계층 단위 테스트 100% 통과

### Week 2: 대용량 파일 업로드 시스템 구축

#### 📅 Day 1-3: 멀티파트 파일 업로드 API 고도화

**구체적 구현 사항:**
- [ ] 2GB 이상 대용량 파일 청크 업로드 지원
- [ ] A영상 + B영상 + 촬영 메타데이터 동시 처리
- [ ] 업로드 진행률 Redis 캐싱 및 실시간 조회
- [ ] 파일 형식 validation (MP4, MOV, AVI만 허용)
- [ ] 중복 업로드 방지 (파일 해시 체크)
- [ ] S3 Multipart Upload 구현 (메모리 효율성)
- [ ] 촬영 메타데이터(줌 배율, 좌표) JSON 파싱 및 저장

#### 📅 Day 4-5: 메타데이터 자동 추출 시스템

**구체적 구현 사항:**
- [ ] FFmpeg Java 라이브러리 연동 (Jave2 또는 FFmpeg-CLI)
- [ ] 썸네일 자동 생성 (3개 구간: 10%, 50%, 90%)
- [ ] **오디오 트랙 분리 및 독립 파일 생성** (음악 분석 준비)
- [ ] 비디오 메타데이터 추출 (해상도, 길이, 비트레이트, FPS)
- [ ] 오디오 메타데이터 추출 (샘플레이트, 비트레이트, 채널)
- [ ] 비동기 처리로 업로드 블로킹 방지

#### 🎯 완료 기준
- 2GB 파일 5분 이내 업로드 완료
- 메타데이터 추출 정확도 95% 이상
- 썸네일 생성 성공률 99% 이상
- 동시 업로드 10개 처리 가능

### Week 3: 사용자 API 및 토큰 결제 시스템

#### 📅 Day 1-2: 영상 조회 및 관리 API

**구체적 구현 사항:**
- [ ] 복합 인덱스 최적화 (member_id + created_date + status)
- [ ] Redis 캐싱으로 목록 조회 성능 개선
- [ ] 썸네일 CDN URL 자동 생성
- [ ] 무한 스크롤 지원 (Cursor 기반 페이징)

#### 📅 Day 3-4: 토큰 구매 및 결제 연동

**구체적 구현 사항:**
- [ ] 포트원(아임포트) SDK 연동
- [ ] 토큰 패키지 정책 (100개/1만원, 500개/4만원, 1000개/7만원)
- [ ] 결제 실패 시 자동 롤백 로직
- [ ] PG사 웹훅 검증 및 중복 결제 방지

#### 📅 Day 5: 대시보드 및 통계 API

#### 🎯 완료 기준
- 1000건 영상 목록 조회 < 300ms
- 토큰 결제 성공률 99.5% 이상
- 대시보드 로딩 시간 < 500ms
- 결제 보안 검증 100% 통과

---

## 🤖 Phase 2: AI 서버 연동 및 영상 처리 시스템 (4주)

### Week 4: AI 서버 통신 모듈 구축

#### 📅 Day 1-3: AI 서버 클라이언트 핵심 구현

**구체적 구현 사항:**
- [ ] **파이썬 AI 서버 통합 클라이언트 구성** (영상처리, 얼굴인식, 음악분석)
- [ ] WebClient 커넥션 풀 최적화 (최대 100 커넥션)
- [ ] 처리 타입별 요청 타임아웃 정책 (영상처리: 30분, 얼굴인식: 5분, 음악분석: 2분)
- [ ] 지수 백오프 재시도 로직 (2초, 4초, 8초)
- [ ] 통합 AI 서버 Circuit Breaker 설정
- [ ] **YOLO 기반 얼굴 인식 API 연동** (B영상 → 얼굴 좌표 JSON)
- [ ] **음원 식별 API 연동** (Shazam-like Audio Fingerprinting)
- [ ] **음악 구조 분석 API 연동** (MIT Music Structure Analysis)

#### 📅 Day 4-5: 영상 처리 요청 API 구현

**구체적 구현 사항:**
- [ ] **기존 C영상 생성 API 확장** (A영상 → AI 영상 처리)
- [ ] **새로운 얼굴 인식 API 추가** (B영상 → 얼굴 좌표 추출)
- [ ] **음악 분석 API 추가** (오디오 → 하이라이트 구간 분석)
- [ ] 토큰 차감 로직 확장 (처리 타입별 차등 적용)
- [ ] S3 Pre-signed URL 생성 로직 확장
- [ ] 통합 AI 처리 오케스트레이션 (기능별 API 엔드포인트 분기)

#### 🎯 완료 기준
- AI 서버 통신 성공률 99% 이상
- 영상 처리 요청 응답 시간 < 3초
- 얼굴 인식 요청 응답 시간 < 1초  
- 음악 분석 요청 응답 시간 < 2초
- 토큰 차감 로직 무결성 100% 보장

### Week 5: AI 서버 결과 수신 및 웹훅 시스템

#### 📅 Day 1-3: 웹훅 기반 결과 수신 구현

**구체적 구현 사항:**
- [ ] **통합 웹훅 엔드포인트 구성** (처리 타입별 분기 로직)
- [ ] 웹훅 서명 검증 (HMAC-SHA256)
- [ ] 중복 웹훅 요청 처리 (멱등성 보장)
- [ ] 웹훅 재시도 로직 (AI 서버 측에서 5회 재시도)
- [ ] **영상 처리 결과 처리** (C영상 S3 경로 → DB 저장)
- [ ] **얼굴 인식 결과 처리** (프레임별 좌표 JSON → DB 저장)
- [ ] **음악 분석 결과 처리** (하이라이트 구간 → 클라이언트 전달)
- [ ] 처리 실패 시 토큰 환불 로직

#### 📅 Day 4-5: 진행률 실시간 추적 시스템

#### 🎯 완료 기준
- 웹훅 처리 성공률 100%
- 진행률 업데이트 지연시간 < 30초
- 처리 실패 시 토큰 환불 자동화 100%

### Week 6: 사용자 결과 제공 및 다운로드 시스템

#### 📅 Day 1-3: 처리된 영상 제공 API 구현

**구체적 구현 사항:**
- [ ] HTTP Range 요청 지원 (모바일 스트리밍 최적화)
- [ ] CDN 연동으로 글로벌 다운로드 가속화
- [ ] 다운로드 횟수 제한 (C영상: 5회, 하이라이트: 무제한)
- [ ] 워터마크 옵션 (유료 사용자는 워터마크 제거)

#### 📅 Day 4-5: 장애 복구 및 모니터링 시스템

#### 🎯 완료 기준
- 다운로드 성공률 99.9% 이상
- 스트리밍 버퍼링 시간 < 2초
- 실패 작업 자동 복구율 90% 이상

### Week 7: 성능 최적화 및 테스트

#### 📅 Day 1-3: 고급 토큰 시스템 및 AI 모델 선택

#### 📅 Day 4-5: 통합 테스트 및 성능 검증
- [ ] 전체 플로우 E2E 테스트 (업로드→처리→다운로드)
- [ ] 동시 사용자 100명 부하 테스트
- [ ] AI 서버 장애 시나리오 테스트
- [ ] 토큰 결제 및 환불 시나리오 테스트

#### 🎯 완료 기준
- 전체 처리 플로우 성공률 98% 이상
- 동시 처리 50개 영상 안정성 확보
- 평균 응답 시간 < 300ms
- 메모리 사용량 < 2GB (인스턴스당)

### Week 7: 하이라이트 클립 생성 시스템 구축

#### 📅 Day 1-3: 음악 기반 하이라이트 클립 API 구현

**구체적 구현 사항:**
- [ ] **하이라이트 클립 생성 API** (음악 분석 결과 기반)
- [ ] 클립 길이 선택 지원 (15초, 30초, 60초)
- [ ] 클립 타입별 생성 (도입부, 후렴구, 클라이맥스, 브릿지)
- [ ] 사용자 선택형 클립 생성 (특정 구간 지정 가능)
- [ ] 클립 메타데이터 관리 (시작시간, 길이, 타입)

#### 📅 Day 4-5: 클립 다운로드 및 관리 API

**구체적 구현 사항:**
- [ ] 클립 목록 조회 API (영상별, 타입별 필터링)
- [ ] 클립 다운로드 API (Pre-signed URL 제공)
- [ ] 클립 미리보기 API (썸네일 + 짧은 프리뷰)
- [ ] 클립 삭제 및 재생성 API
- [ ] 클립 공유 기능 (소셜 미디어 최적화 포맷)

#### 🎯 완료 기준
- 5분 영상에서 하이라이트 클립 생성 시간 < 2분
- 음악 구조 분석 정확도 90% 이상
- 클립 다운로드 성공률 99.9% 이상
- 클립 품질 만족도 85% 이상

---

## ⚡ Phase 3: 실시간 기능 및 UX 개선 (2-3주)

### Week 8: WebSocket 실시간 통신

#### 📅 작업 항목
- [ ] **WebSocket 설정** (2일)
  - STOMP 프로토콜 설정
  - JWT 인증 연동
  - 연결 관리

- [ ] **실시간 진행률 Push** (2일)
  - 진행률 변경 시 자동 push
  - 클라이언트별 구독 관리
  - 메시지 큐 최적화

- [ ] **SSE 대체 방안** (1일)
  - WebSocket 미지원 환경 대응
  - 자동 재연결 로직

#### 🔧 구현 예시
```java
@MessageMapping("/video.progress")
@SendTo("/topic/progress/{videoId}")
public ProgressMessage updateProgress(Long videoId, int progress) {
    return ProgressMessage.builder()
        .videoId(videoId)
        .progress(progress)
        .estimatedTime(calculateETA(progress))
        .build();
}
```

### Week 9: 하이라이트 클립 기능

#### 📅 작업 항목
- [ ] **음악 분석 연동** (3일)
  - 음악 인식 API 연동
  - 구간별 하이라이트 추출
  - 클립 길이별 생성 (15s, 30s, 60s)

- [ ] **클립 관리 API** (2일)
  - 클립 목록 조회
  - 클립 다운로드
  - 클립 메타데이터 관리

### Week 10: 성능 최적화 및 캐싱

#### 📅 작업 항목
- [ ] **Redis 캐싱 전략** (2일)
  - 자주 조회되는 데이터 캐싱
  - 캐시 무효화 정책
  - 캐시 히트율 모니터링

- [ ] **CDN 연동** (2일)
  - CloudFront 설정
  - 정적 파일 캐싱
  - 지역별 성능 최적화

- [ ] **데이터베이스 최적화** (1일)
  - 인덱스 최적화
  - 쿼리 성능 튜닝
  - 연관관계 lazy loading

---

## 🚀 Phase 4: 이벤트 기반 아키텍처 전환 (2-3주)

### Week 11: 도메인 이벤트 시스템

#### 📅 작업 항목
- [ ] **도메인 이벤트 정의** (2일)
  - VideoUploadedEvent
  - VideoProcessingStartedEvent  
  - VideoProcessingCompletedEvent
  - TokenUsedEvent

- [ ] **이벤트 발행/구독** (3일)
  - Spring Events 활용
  - 이벤트 핸들러 구현
  - 비동기 이벤트 처리

#### 🔧 이벤트 기반 설계
```java
@DomainEvents
Collection<DomainEvent> domainEvents() {
    return Collections.singletonList(
        new VideoProcessingCompletedEvent(this.id, this.status)
    );
}

@EventListener
@Async
public void handleVideoCompleted(VideoProcessingCompletedEvent event) {
    // 알림 발송, 통계 업데이트 등
}
```

### Week 12: 최종 성능 테스트 및 배포 준비

#### 📅 작업 항목
- [ ] **부하 테스트** (2일)
  - JMeter 기반 성능 테스트
  - 동시 사용자 100명 기준
  - 병목 지점 분석 및 개선

- [ ] **통합 테스트** (2일)
  - TestContainers 활용
  - E2E 테스트 자동화
  - CI/CD 파이프라인 구축

- [ ] **배포 및 모니터링** (1일)
  - Docker 컨테이너화
  - 로그 수집 시스템
  - 헬스체크 API

---

## 📊 최종 성능 목표 및 비즈니스 KPI

### 핵심 성능 지표
- **파일 업로드**: 2GB 파일 < 5분, A+B영상+메타데이터 동시 처리
- **AI 처리 시간**: 
  - 영상 처리: 5분 영상 → 15-30분 (C영상 생성)
  - 얼굴 인식: 5분 영상 → 2-3분 (좌표 추출)  
  - 음악 분석: 5분 영상 → 1-2분 (하이라이트 구간)
- **API 응답시간**: 평균 < 200ms, 99% < 1초
- **동시 처리 용량**: 최대 100개 영상 처리 (기능별 분산)
- **가용성**: 99.95% 업타임 (월 22분 이내 다운타임)

### 비즈니스 성과 지표
- **토큰 구매 전환율**: 무료 사용자 → 유료 전환 25% 목표 (하이라이트 클립 효과)
- **처리 성공률**: 
  - C영상 생성: 98% 이상 
  - 얼굴 인식: 95% 이상
  - 음악 분석: 90% 이상 (공연 환경 변수 고려)
- **사용자 만족도**: 
  - C영상 품질: 90% 이상
  - 하이라이트 클립 품질: 85% 이상
- **재방문율**: 월 3회 이상 사용자 65% 유지 (클립 공유 효과)

### 🚀 신입 개발자 기술적 어필 핵심 포인트

#### 1. **전문적인 대용량 파일 처리 시스템**

#### 2. **고가용성 분산 시스템 설계**
- Circuit Breaker 패턴으로 99.9% 가용성 달성
- 마이크로서비스 간 비동기 통신으로 장애 격리
- Redis 클러스터링으로 세션 데이터 분산 저장

#### 3. **실시간 사용자 경험 최적화**

#### 4. **데이터 일관성 및 트랜잭션 관리**

#### 5. **성능 모니터링 및 최적화**

#### 6. **확장 가능한 아키텍처 패턴**
- **CQRS 패턴**: 조회와 명령 분리로 읽기 성능 최적화
- **이벤트 소싱**: 토큰 사용 내역 완벽 추적
- **Saga 패턴**: 분산 트랜잭션 관리 (결제↔토큰지급)

### 💼 면접에서 어필할 수 있는 실무 경험

1. **"파이썬 AI 서버와 연동한 복합 영상 처리 시스템을 구축했습니다"**
   - 영상처리, 얼굴인식, 음악분석 통합 AI 서버 오케스트레이션
   - Circuit Breaker 및 장애 격리로 안정성 확보
   - 기능별 API 분기 처리로 효율적인 자원 활용

2. **"2GB 대용량 파일과 실시간 메타데이터를 동시 처리했습니다"**
   - A영상 + B영상 + 촬영 로그 병렬 업로드
   - FFmpeg 기반 오디오 분리 및 메타데이터 추출
   - 메모리 사용량 95% 감소, 처리 속도 300% 향상

3. **"YOLO 기반 얼굴 인식과 음악 구조 분석을 통합했습니다"**
   - 프레임별 얼굴 좌표 추출로 자동 직캠 생성
   - MIT Music Structure Analysis로 하이라이트 클립 자동 생성
   - 사용자 만족도 90% 이상, 유료 전환율 25% 달성

4. **"실시간 진행률 추적과 토큰 기반 다차원 과금 시스템"**
   - WebSocket으로 다중 AI 처리 진행률 실시간 전송
   - 처리 타입별 차등 토큰 정책으로 수익 최적화
   - 자동 환불 시스템으로 고객 만족도 향상

5. **"확장 가능한 하이라이트 클립 생성 플랫폼 구축"**
   - 음악 구조 기반 15s/30s/60s 클립 자동 생성
   - 소셜 미디어 최적화 포맷 지원
   - 클립 공유 기능으로 바이럴 마케팅 효과 창출

---

## 🎯 Spring 서버의 핵심 역할 확장 요약

### 1. **다중 영상 및 메타데이터 처리**: 모바일 ↔ Spring
- **A영상(전체무대) + B영상(확대화면) + 촬영메타데이터** 동시 업로드
- 줌 배율, 중심 좌표 등 촬영 로그 JSON 파싱 및 저장
- FFmpeg 기반 오디오 트랙 분리 (음악 분석 준비)
- S3 병렬 업로드 및 Redis 진행률 추적

### 2. **파이썬 AI 서버 오케스트레이션**: Spring ↔ 통합 AI 서버
- **영상 처리**: A영상 → 고품질 C영상 생성
- **얼굴 인식**: B영상 → YOLO 기반 얼굴 좌표 추출  
- **음악 분석**: 오디오 → 구조 분석 + 하이라이트 구간 추출
- 통합 AI 서버 Circuit Breaker 및 기능별 토큰 관리

### 3. **통합 웹훅 결과 관리**: 파이썬 AI 서버 → Spring
- 영상 처리 완료 → S3 경로 및 상태 업데이트
- 얼굴 인식 결과 → 프레임별 좌표 JSON DB 저장
- 음악 분석 결과 → 하이라이트 구간 정보 클라이언트 전달
- 실패 시 처리 타입별 차등 토큰 환불

### 4. **하이라이트 클립 생성 관리**: Spring ↔ 사용자
- 음악 분석 결과 기반 클립 생성 API (15s/30s/60s)
- 클립 타입별 관리 (도입부, 후렴구, 클라이맥스, 브릿지)  
- 클립 목록/다운로드/공유 API 제공
- 소셜 미디어 최적화 포맷 지원

### 5. **확장된 토큰 경제 시스템**: 결제 및 다차원 사용량 관리
- AI 기능별 차등 토큰 정책 (영상처리, 얼굴인식, 음악분석)
- 클립 생성 기능별 토큰 차감 시스템
- 하이라이트 클립 프리미엄 기능 과금
- 포트원 PG 연동 및 상세 사용 내역 분석

---

## 🔧 개발 환경 및 도구

### 기술 스택
- **Framework**: Spring Boot 3.x, Spring WebFlux
- **Database**: MySQL 8.0, Redis 7.0
- **Cloud**: AWS S3, CloudFront
- **Monitoring**: Micrometer, Prometheus, Grafana
- **Test**: JUnit 5, TestContainers, MockMvc

### 개발 도구
- **IDE**: IntelliJ IDEA
- **API Test**: Postman, JMeter
- **Version Control**: Git, GitHub
- **CI/CD**: GitHub Actions
- **Container**: Docker, Docker Compose

---

## ⚠️ 위험 요소 및 대응 방안

### 주요 위험 요소
1. **AI 서버 의존성**: AI 서버 장애 시 서비스 중단
2. **대용량 파일 처리**: 메모리 부족, 타임아웃
3. **동시 처리 한계**: 서버 리소스 부족
4. **비동기 처리 복잡성**: 상태 관리 어려움

### 대응 방안
1. **Circuit Breaker**: 장애 격리 및 빠른 실패
2. **스트리밍 처리**: 메모리 사용량 최적화
3. **Auto Scaling**: 클라우드 기반 자동 확장
4. **상태 머신**: 명확한 상태 전이 관리

---

## 📝 다음 단계

1. **Phase 1 완료 후**: MVP 데모 가능
2. **Phase 2 완료 후**: 베타 서비스 출시
3. **Phase 3 완료 후**: 정식 서비스 런칭
4. **Phase 4 완료 후**: 확장성 있는 아키텍처 완성

각 Phase 완료 시점에서 코드 리뷰, 성능 측정, 문서화를 통해 품질을 보장하고, 다음 단계로 안정적으로 진행합니다.
